(function(){define(["angular","facebook","pnotify"],function(a,b){var c;return c=a.module("topfriends.facebook",[]),c.service("facebook",["$http","$rootScope",function(a,b){return{login:function(c,d){var e;return e={},"connected"===c.status?a({url:"/status",method:"GET",params:{from:"facebook",token:c.authResponse.accessToken}}).success(function(a){console.log(a),a.data&&(e.user=a.data,e.authenticated=!0),b.user=e,d(e)}):void 0}}}]),c.directive("topfriendsLogout",["$http",function(a){return{link:function(b,c){c.click(function(){a["delete"]("/user").success(function(){return location.href="/"})})}}}]),c.directive("topfriendsQuitFacebook",["$http",function(a){return{link:function(c,d){d.click(function(){a["delete"]("/user").success(function(){b.api("/me/permissions","DELETE",function(){location.href="/"})})})}}}]),c.directive("topfriendsFacebook",["$rootScope","facebook",function(a,c){return{require:"ngModel",scope:{ngModel:"=",fbScope:"=",complete:"&"},link:function(d,e){return e.click(function(){return b.login(function(b){null==b.authResponse&&$.pnotify({type:"alert",text:__("VocÃª precisa autorizar o aplicativo")}),c.login(b,function(b){d.ngModel.user=b.user,d.ngModel.authenticated=b.authenticated,a.user=b.user,d.complete()})},{scope:"email"})})}}}]),c.directive("topfriendsFacebookAuthorize",["facebook","$compile","$http","$templateCache","$rootScope",function(a,c,d,e,f){return{scope:{topfriendsFacebookAuthorize:"@"},link:function(g,h){return f.$watch("user",function(){var i,j,k,l,m,n;if(h.hide(),f.user&&f.user.permissions){for(j=!0,l=g.topfriendsFacebookAuthorize.split(/,/g),m=0,n=l.length;n>m;m++)k=l[m],null==f.user.permissions[k]&&(j&=!1);if(j)return h.hasClass("topfriends-facebook-authorize-ready")&&(h.parent().find(".topfriends-facebook-authorize").remove(),h.removeClass("topfriends-facebook-authorize-ready")),h.show();if(i=function(c){c.find(".auth-button").click(function(){return b.login(function(b){a.login(b,function(a){console.log(a),f.user=a.user})},{scope:g.topfriendsFacebookAuthorize})})},!h.hasClass("topfriends-facebook-authorize-ready"))return h.addClass("topfriends-facebook-authorize-ready"),d.get("/templates/facebook_authorize",{cache:e}).success(function(a){var b;return b=c(a)(g),i(b),b.insertAfter(h)})}})}}}])})}).call(this);